/**
 * bootstrap-suggest-plugin - v0.1.20
 * @description 这是一个基于 bootstrap 按钮式下拉菜单组件的搜索建议插件，必须使用于按钮式下拉菜单组件上。
 * @author [object Object]
 * @GitHub https://github.com/lzwme/bootstrap-suggest-plugin.git
 * @since 2017-08-29 12:00:34
 */
!function(a){if("function"==typeof define&&define.amd)define(["jquery"],a);else if("object"==typeof exports&&"object"==typeof module)a(require("jquery"));else{if(!window.jQuery)throw new Error("Not found jQuery.");a(window.jQuery)}}(function(a){function b(a,b){window.console&&window.console.trace&&(console.trace(a),b&&console.trace(b))}function c(a){return a.data()}function d(a,b){return void 0!==b?a.attr("alt",b):a.attr("alt")}function e(a,b){return void 0!==b?a.attr("data-id",b):a.attr("data-id")}function f(a,b,c){if(b&&b.key){var d,f,g=c.separator||",",h=e(a);c&&c.multiWord?(d=a.val().split(g),d[d.length-1]=b.key,h?(f=h.split(g),f.push(b.id)):f=[b.id],e(a,f.join(g)).val(d.join(g)).focus()):e(a,b.id).val(b.key).focus(),a.trigger("onSetSelectValue",[b,(c.data.value||c._lastData.value)[b.index]])}}function g(a,b,c){if(b.is(":visible")){var d=a.parent();c.autoDropup&&setTimeout(function(){w.height()+w.scrollTop()-a.offset().top<b.height()&&a.offset().top>b.height()+w.scrollTop()?d.addClass("dropup"):d.removeClass("dropup")},10);var e={};return"left"===c.listAlign?e={left:a.siblings("div").width()-d.width(),right:"auto"}:"right"===c.listAlign&&(e={left:"auto",right:0}),x&&!c.showBtn&&(d.hasClass("dropup")?(e.top="auto",e.bottom=d.height()):(e.top=d.height(),e.bottom="auto")),c.autoMinWidth||(e.minWidth=d.width()),b.css(e),a}}function h(a,b){var c,d,f;return-1===b.indexId&&!b.idField||b.multiWord?a:(c=a.css("background-color").replace(/ /g,"").split(",",3).join(","),d=b.inputBgColor||"rgba(255,255,255,0.1)",f=b.inputWarnColor||"rgba(255,255,0,0.1)",e(a)||!a.val()?a.css("background",d):(~f.indexOf(c)||a.trigger("onUnsetSelectValue").css("background",f),a))}function i(a,b,c){var d,e,f=a.parent().find("tbody tr."+c.listHoverCSS);f.length&&(d=(f.index()+3)*f.height(),e=Number(b.css("max-height").replace("px","")),d>e||b.scrollTop()>e?d-=e:d=0,b.scrollTop(d))}function j(a,b){a.find("tr."+b.listHoverCSS).removeClass(b.listHoverCSS)}function k(a,b,c){return!b.length||a.data(A)?D:(a.data(A,{options:c}),C)}function l(a){var c,d=C;for(c in a)if("value"===c){d=D;break}return d?(b("返回数据格式错误!"),D):a.value.length?a:D}function m(b,c){var d=c.effectiveFields;return!("__index"===b||d.length&&!~a.inArray(b,d))}function n(b,c){return~a.inArray(b,c.searchFields)}function o(a,b,c,d){c.html('<div style="padding:10px 5px 5px">'+a+"</div>").show(),g(b,c,d)}function p(a,b,c){var d,e,f,h,i,j,k=a.parent().find("ul:eq(0)"),l=0,n=['<table class="table table-condensed table-sm" style="margin:0">'];if(!b||!(d=b.value.length))return c.emptyTip?o(c.emptyTip,a,k,c):k.empty().hide(),a;var p=b.value;if(c._lastData&&JSON.stringify(c._lastData.value)===JSON.stringify(p)&&k.find("tr").length===d)return k.show(),g(a,k,c),a;if(c._lastData=b,c.showHeader){n.push("<thead><tr>");for(f in p[0])m(f,c)&&(n.push("<th>",c.effectiveFieldsAlias[f]||f,0===l?"("+d+")":"","</th>"),l++);n.push("</tr></thead>")}n.push("<tbody>");var q;for(e=0;e<d;e++){l=0,h=[],q=p[e],i=q[c.idField]||"",j=q[c.keyField]||"";for(f in q)j||c.indexKey!==l||(j=q[f]),i||c.indexId!==l||(i=q[f]),l++,m(f,c)&&h.push('<td data-name="',f,'">',q[f],"</td>");n.push('<tr data-index="',q.__index||e,'" data-id="',i,'" data-key="',j,'">',h.join(""),"</tr>")}return n.push("</tbody></table>"),k.html(n.join("")).show(),setTimeout(function(){if(!z){var a=k.find("table:eq(0)"),b=0,c=0;k.height()<a.height()&&Number(k.css("min-width").replace("px",""))<k.width()&&(b=18,c=20),k.css("padding-right",b),a.css("margin-bottom",c)}},301),g(a,k,c),a}function q(b,c){c=c||"";var d=b._preAjax;d&&d.abort&&4!==d.readyState&&d.abort();var e={type:"GET",dataType:b.jsonp?"jsonp":"json",timeout:5e3};b.jsonp&&(e.jsonp=b.jsonp);var f,g=b.fnAdjustAjaxParam;if(a.isFunction(g)){if(f=g(c,b),D===f)return;a.extend(e,f)}return e.url=function(){if(!c||e.data)return e.url||b.url;var a="?";return/=$/.test(b.url)?a="":/\?/.test(b.url)&&(a="&"),b.url+a+c}(),b._preAjax=a.ajax(e).done(function(a){b.data=b.fnProcessData(a)}).fail(function(a){b.fnAjaxFail&&b.fnAjaxFail(a,b)})}function r(b,c,d,e){return d=a.trim(d),e.ignorecase&&(b=b.toLocaleLowerCase(),d=d.toLocaleLowerCase()),d&&(m(c,e)||n(c,e))&&("all"===e.matchMode&&~d.indexOf(b)||"left"===e.matchMode&&d.startsWith(b)||"right"===e.matchMode&&d.endsWith(b)||e.twoWayMatch&&~b.indexOf(d))}function s(b,c,d,e){var f,g,h,i,j={value:[]},k=e.fnPreprocessKeyword;if(b=b||"",a.isFunction(k)&&(b=k(b,e)),e.url){var m;e.searchingTip&&(m=setTimeout(function(){o(e.searchingTip,c,c.parent().find("ul"),e)},600)),q(e,b).done(function(a){d(c,e.data,e),c.trigger(B,a),"firstByUrl"===e.getDataMethod&&(e.url=null)}).always(function(){m&&clearTimeout(m)})}else{if(f=e.data,l(f))if(b){for(i=f.value.length,g=0;g<i;g++)for(h in f.value[g])if(f.value[g][h]&&r(b,h,f.value[g][h]+"",e)){j.value.push(f.value[g]),j.value[j.value.length-1].__index=g;break}}else j=f;d(c,j,e)}}function t(a){return l(a)}function u(b,c){var d=b.prev("i.clearable");return c.clearable&&!d.length&&(d=a('<i class="clearable glyphicon glyphicon-remove"></i>').prependTo(b.parent())),d.css({position:"absolute",top:12,right:c.showBtn?(b.next(".input-group-btn").width()||33)+2:12,zIndex:4,cursor:"pointer",fontSize:12}).hide()}var v,w=a(window),x="ActiveXObject"in window,y=navigator.userAgent.match(/Chrome\/(\d+)/);y&&(y=Number(y[1]));var z=x||y>51,A="bsSuggest",B="onDataRequestSuccess",C=!0,D=!1,E={url:null,jsonp:null,data:{value:[]},indexId:0,indexKey:0,idField:"",keyField:"",autoSelect:C,allowNoKeyword:C,getDataMethod:"firstByUrl",delayUntilKeyup:D,ignorecase:D,effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],twoWayMatch:C,multiWord:D,separator:",",delay:300,emptyTip:"",searchingTip:"搜索中...",matchMode:"all",autoDropup:D,autoMinWidth:D,showHeader:D,showBtn:C,inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"},listAlign:"left",listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",clearable:D,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13,fnProcessData:t,fnGetData:s,fnAdjustAjaxParam:null,fnPreprocessKeyword:null,fnAjaxFail:null},F={init:function(b){var l=this;return b=b||{},void 0===b.showHeader&&b.effectiveFields&&b.effectiveFields.length>1&&(b.showHeader=C),b=a.extend(C,{},E,b),b.processData&&(b.fnProcessData=b.processData),b.getData&&(b.fnGetData=b.getData),"firstByUrl"===b.getDataMethod&&b.url&&!b.delayUntilKeyup&&q(b).done(function(a){b.url=null,l.trigger(B,a)}),a("#"+A).length||a("head:eq(0)").append('<style id="'+A+'">.'+b.listHoverCSS+"{"+b.listHoverStyle+"}</style>"),l.each(function(){var l,m,n=a(this),o=n.parent(),q=u(n,b),r=o.find("ul:eq(0)");if(!k(n,r,b))return void console.warn("不是一个标准的 bootstrap 下拉式菜单或已初始化:",n);b.showBtn||(n.css("border-radius","4px"),o.css("width","100%").find(".btn:eq(0)").hide()),n.removeClass("disabled").prop("disabled",D).attr("autocomplete","off"),r.css(b.listStyle),b.inputBgColor||(b.inputBgColor=n.css("background-color")),n.on("keydown",function(a){var g,h;if(r.is(":visible")){if(g=r.find("."+b.listHoverCSS),h="",j(r,b),a.keyCode===b.keyDown){if(g.length?g.next().length?h=c(g.next().mouseover()):b.autoSelect&&e(n,"").val(d(n)):h=c(r.find("tbody tr:first").mouseover()),i(n,r,b),!b.autoSelect)return}else if(a.keyCode===b.keyUp){if(g.length?g.prev().length?h=c(g.prev().mouseover()):b.autoSelect&&e(n,"").val(d(n)):h=c(r.find("tbody tr:last").mouseover()),i(n,r,b),!b.autoSelect)return}else a.keyCode===b.keyEnter?(h=c(g),r.hide()):e(n,"");f(n,h,b)}}).on("compositionstart",function(a){v=C}).on("compositionend",function(a){v=D}).on("keyup input paste",function(c){var e;if(c.keyCode&&h(n,b),~a.inArray(c.keyCode,[b.keyDown,b.keyUp,b.keyEnter]))return void n.val(n.val());clearTimeout(m),m=setTimeout(function(){v||(e=n.val(),a.trim(e)&&e===d(n)||(d(n,e),b.multiWord&&(e=e.split(b.separator).reverse()[0]),(e.length||b.allowNoKeyword)&&b.fnGetData(a.trim(e),n,p,b)))},b.delay||300)}).on("focus",function(){g(n,r,b)}).on("blur",function(){l||r.css("display","")}).on("click",function(){var c=n.val();if(a.trim(c)&&c===d(n)&&r.find("table tr").length)return r.show();r.is(":visible")||(b.multiWord&&(c=c.split(b.separator).reverse()[0]),(c.length||b.allowNoKeyword)&&b.fnGetData(a.trim(c),n,p,b))}),o.find(".btn:eq(0)").attr("data-toggle","").click(function(){var a="none";return r.css("display")===a&&(a="block",b.url?(n.click().focus(),r.find("tr").length||(a="none")):p(n,b.data,b)),r.css("display",a),D}),r.mouseenter(function(){l=1,n.blur()}).mouseleave(function(){l=0,n.focus()}).on("mouseenter","tbody tr",function(){return j(r,b),a(this).addClass(b.listHoverCSS),D}).on("mousedown","tbody tr",function(){var e=c(a(this));f(n,e,b),d(n,e.key),h(n,b),r.hide()}),q.length&&(q.click(function(){e(n,"").val(""),h(n,b)}),o.mouseenter(function(){n.prop("disabled")||q.show()}).mouseleave(function(){q.hide()}))})},show:function(){return this.each(function(){a(this).click()})},hide:function(){return this.each(function(){a(this).parent().find("ul:eq(0)").css("display","")})},disable:function(){return this.each(function(){a(this).attr("disabled",C).parent().find(".btn:eq(0)").prop("disabled",C)})},enable:function(){return this.each(function(){a(this).attr("disabled",D).parent().find(".btn:eq(0)").prop("disabled",D)})},destroy:function(){return this.each(function(){a(this).off().removeData(A).removeAttr("style").parent().find(".btn:eq(0)").off().show().attr("data-toggle","dropdown").prop("disabled",D).next().css("display","").off()})},version:function(){return"0.1.20"}};a.fn[A]=function(b){if("string"==typeof b&&F[b]){var c=C;return this.each(function(){if(!a(this).data(A))return c=D}),c||"init"===b||"version"===b?F[b].apply(this,[].slice.call(arguments,1)):this}return F.init.apply(this,arguments)}});